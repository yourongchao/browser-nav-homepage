# 网址输入处理功能优化计划

## 1. 功能概述
优化网址验证和规范化处理功能，支持更多网址格式，提供更好的用户体验，并完善文档。

## 2. 代码修改计划

### 2.1 实现网址验证和规范化处理

#### 2.1.1 添加URL工具函数
在`script.js`中添加URL工具函数，实现：
- 网址格式验证
- 网址规范化处理
- 协议自动补充

#### 2.1.2 修改现有验证逻辑
- 将现有直接使用`new URL()`的验证方式替换为新的验证函数
- 在表单提交、保存并继续、自动获取图标等功能中使用统一的URL处理逻辑

#### 2.1.3 具体实现
```javascript
// URL工具函数
validateAndNormalizeUrl(url) {
    // 去除首尾空格
    url = url.trim();
    if (!url) {
        return { valid: false, message: '网址不能为空' };
    }

    // 规范化处理
    // 1. 对于www.开头的网址，添加https://协议
    if (url.startsWith('www.')) {
        url = `https://${url}`;
    }
    // 2. 对于其他没有协议的网址，尝试添加https://
    else if (!url.startsWith('http://') && !url.startsWith('https://')) {
        url = `https://${url}`;
    }

    // 验证URL格式
    try {
        const urlObj = new URL(url);
        // 验证主机名是否有效
        if (!urlObj.hostname || urlObj.hostname === '') {
            return { valid: false, message: '网址格式无效，请检查主机名' };
        }
        return { valid: true, url: urlObj.toString() };
    } catch (error) {
        return { valid: false, message: `网址格式无效: ${error.message}` };
    }
}
```

### 2.2 修改现有验证逻辑

#### 2.2.1 修改handleEditSubmit方法
```javascript
// 验证URL格式
const validationResult = this.validateAndNormalizeUrl(url);
if (!validationResult.valid) {
    this.showToast(validationResult.message, 'error');
    return;
}
const normalizedUrl = validationResult.url;
```

#### 2.2.2 修改handleSaveAndContinue方法
- 应用相同的URL验证和规范化逻辑

#### 2.2.3 修改autoGetFavicon方法
- 在自动获取图标前添加URL验证和规范化

### 2.3 更新README.md文件

在项目根目录的README.md文件中添加以下内容：
- 网址有效性检测的实现原理说明
- 支持的网址格式列表及示例
- 网址规范化处理的具体规则
- 常见无效网址案例及解决方案
- 相关代码模块的位置及功能说明

## 3. 测试计划

### 3.1 单元测试
- 测试各种URL格式的验证逻辑
- 测试URL规范化处理
- 测试错误提示

### 3.2 边界测试
- 测试空字符串
- 测试特殊字符
- 测试超长URL
- 测试各种协议头

### 3.3 集成测试
- 测试URL验证与表单提交的集成
- 测试URL验证与自动获取图标的集成
- 测试URL验证与保存并继续功能的集成

## 4. 文件修改清单

1. **script.js**：
   - 添加URL工具函数
   - 修改现有URL验证逻辑
   - 更新相关方法

2. **README.md**：
   - 添加网址验证和规范化的文档

## 5. 预期效果

- 支持更多网址格式
- 自动规范化URL格式
- 提供更明确的错误提示
- 完善的文档说明
- 更好的用户体验

## 6. 技术要点

- 使用正则表达式和URL API结合的方式进行验证
- 实现协议自动补充
- 提供详细的错误信息
- 确保验证逻辑的性能和准确性
- 完善的文档支持