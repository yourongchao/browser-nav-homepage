# 浏览器导航主页

一个功能丰富、可自定义的浏览器导航主页，帮助您快速访问常用网站。

## 功能特点

### 🌐 核心功能
- **自定义导航网格**：可自由添加、编辑、删除和排序网站导航图标
- **壁纸设置**：支持上传自定义壁纸，支持恢复默认壁纸
- **布局调整**：可调整列数、间距、图标大小和搜索框透明度
- **数据管理**：支持设置的导入/导出和重置

### 🎯 高级功能
- **工具组功能**：将多个导航项组织成工具组，方便分类管理
- **右键菜单**：支持导航图标的右键操作（编辑、删除、移动、添加到工具组）
- **拖拽排序**：支持导航图标的拖拽排序
- **快捷方式文字颜色设置**：可自定义快捷方式文字颜色，解决壁纸与文字对比度问题
- **响应式设计**：适配不同屏幕尺寸

### 💾 数据存储
- **分层存储策略**：根据浏览器支持情况自动选择最佳存储方案
  - **File System Access API**（优先，Chrome/Edge/Opera支持）
  - **IndexedDB**（备选，所有现代浏览器支持）
  - **localStorage**（后备，所有浏览器支持）
- **本地文件存储**：支持将设置保存到本地JSON文件，提供额外的数据安全性和备份选项

## 浏览器兼容性

### 基本功能
- ✅ Chrome 60+
- ✅ Firefox 55+
- ✅ Safari 12+
- ✅ Edge 79+
- ✅ Opera 47+

### 本地文件存储功能
本地文件存储功能采用分层支持策略：
1. **File System Access API**（提供最佳体验）：
   - ✅ Chrome 86+
   - ✅ Edge 86+
   - ✅ Opera（基于Chrome内核的版本）

2. **IndexedDB**（跨浏览器兼容方案）：
   - ✅ Firefox 55+
   - ✅ Chrome 23+
   - ✅ Edge 79+
   - ✅ Safari 10+
   - ✅ Opera 15+

3. **localStorage**（后备方案）：
   - ✅ 所有现代浏览器

## 快速开始

### 1. 启动本地服务器

```bash
# 使用Python 3
python -m http.server 8000

# 或使用Python 2
python -m SimpleHTTPServer 8000

# 或使用Node.js
npx http-server -p 8000
```

### 2. 访问应用

在浏览器中访问：`http://localhost:8000`

### 3. 开始使用

- 点击"设置"按钮打开设置面板
- 自定义壁纸、布局和导航项
- 享受个性化的导航体验

## 使用说明

### 添加导航项
1. 点击"设置"按钮打开设置面板
2. 在"导航管理"部分点击"添加新导航项"
3. 填写名称、网址和选择图标
4. 点击"保存"完成添加

### 编辑导航项
1. 右键点击导航图标
2. 选择"编辑网址"
3. 修改相关信息
4. 点击"保存"完成编辑

### 调整布局
1. 点击"设置"按钮打开设置面板
2. 在"布局调整"部分拖动滑块
3. 实时预览调整效果
4. 调整完成后关闭设置面板

### 设置壁纸
1. 点击"设置"按钮打开设置面板
2. 在"壁纸设置"部分点击"上传壁纸"
3. 选择本地图片文件
4. 预览壁纸效果
5. 关闭设置面板完成设置

### 自定义文字颜色
1. 点击"设置"按钮打开设置面板
2. 在"外观设置"部分选择颜色
3. 实时预览文字颜色效果
4. 关闭设置面板完成设置

## 常见问题解答

### Q: 点击"启用本地文件存储"后提示"您的浏览器不支持文件系统访问API"？

A: 这是由于浏览器兼容性问题导致的。系统检测到您的浏览器不支持`File System Access API`，但您仍然可以使用其他存储方案。

**解决方案**：
1. **继续使用当前浏览器**：系统会自动选择最佳的替代存储方案（IndexedDB或localStorage），不影响核心功能
2. **无需更换浏览器**：系统已优化为支持所有现代浏览器，包括Firefox最新版
3. **使用导入/导出功能**：无论使用哪种浏览器，都可以通过"导出设置"和"导入设置"功能手动备份和恢复数据

### Q: 如何备份我的设置？

A: 有两种方法备份设置：
1. **使用导入/导出功能**：在设置面板的"数据管理"部分，点击"导出设置"下载JSON文件
2. **使用本地文件存储**：如果浏览器支持，可以启用本地文件存储，设置会自动保存到本地JSON文件

### Q: 如何恢复默认设置？

A: 在设置面板的"数据管理"部分，点击"重置为默认设置"按钮，确认后即可恢复默认设置。

### Q: 如何调整导航项的顺序？

A: 有两种方法调整导航项顺序：
1. **拖拽排序**：直接拖拽导航图标到目标位置
2. **右键菜单**：右键点击导航图标，选择"上移"或"下移"

## 项目结构

```
浏览器导航主页/
├── index.html          # 主HTML文件
├── style.css           # 样式文件
├── script.js           # 主JavaScript文件
└── README.md           # 项目说明文档
```

## 技术栈

- **前端技术**：HTML5 + CSS3 + JavaScript (ES6+)
- **数据存储**：
  - File System Access API（可选，Chrome/Edge/Opera支持）
  - IndexedDB（跨浏览器兼容方案）
  - localStorage（后备方案）
- **设计模式**：面向对象编程（OOP）
- **架构风格**：模块化设计，适配器模式实现存储方案的灵活切换

## 网址验证与规范化

### 实现原理

网址验证与规范化功能通过以下步骤实现：
1. **输入预处理**：去除网址首尾空格
2. **协议自动补充**：对缺少协议的网址自动添加`https://`协议前缀
3. **格式验证**：使用`URL`构造函数验证网址格式的有效性
4. **主机名验证**：确保网址包含有效的主机名
5. **规范化输出**：返回符合标准URL格式的规范化网址

### 支持的网址格式

| 网址格式 | 示例 | 处理结果 |
|---------|------|---------|
| http://开头 | http://www.example.com | http://www.example.com/ |
| https://开头 | https://www.example.com | https://www.example.com/ |
| www.开头 | www.example.com | https://www.example.com/ |
| 无协议 | example.com | https://example.com/ |
| 带路径 | example.com/path | https://example.com/path |
| 带查询参数 | example.com?query=value | https://example.com/?query=value |
| 带锚点 | example.com#anchor | https://example.com/#anchor |

### 规范化规则

1. **协议补充**：
   - 对于以`www.`开头的网址，自动添加`https://`协议前缀
   - 对于其他没有协议的网址，自动添加`https://`协议前缀
   - 保留原始协议（http://或https://）

2. **格式规范化**：
   - 确保网址符合标准URL格式
   - 自动补充缺失的斜杠
   - 规范化查询参数和锚点

3. **错误处理**：
   - 空网址：提示"网址不能为空"
   - 无效格式：提示具体错误信息
   - 无效主机名：提示"网址格式无效，请检查主机名"

### 常见无效网址案例及解决方案

| 无效网址 | 错误原因 | 解决方案 |
|---------|---------|---------|
| `example` | 缺少主机名后缀 | 添加完整域名：example.com |
| `http://` | 缺少主机名 | 添加完整主机名：http://example.com |
| `http://.com` | 无效主机名 | 添加有效的主机名：http://example.com |
| `example..com` | 无效域名格式 | 修正域名格式：example.com |
| `http:// example.com` | 包含空格 | 移除空格：http://example.com |

### 相关代码模块

| 代码位置 | 功能说明 |
|---------|---------|
| `script.js:2861-2890` | `validateAndNormalizeUrl()` 方法：实现网址验证和规范化的核心逻辑 |
| `script.js:2532-2548` | `handleEditSubmit()` 方法：使用新的URL验证逻辑处理表单提交 |
| `script.js:2566-2582` | `handleSaveAndContinue()` 方法：使用新的URL验证逻辑处理保存并继续功能 |
| `script.js:2716-2750` | `autoGetFavicon()` 方法：在自动获取图标前进行URL验证和规范化 |

## 开发说明

### 核心类

1. **NavigationModel**：数据模型类，负责所有数据的存储、加载和操作
2. **NavigationApp**：主应用类，负责UI渲染、事件处理和用户交互

### 本地开发

1. 克隆或下载项目文件
2. 启动本地HTTP服务器
3. 在浏览器中访问项目
4. 开始开发和调试

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request，共同改进这个项目。

## 更新日志

### 最新版本
- **优化本地存储功能兼容性**：确保在Firefox最新版浏览器中正常使用
- 实现了分层存储策略：File System Access API → IndexedDB → localStorage
- 添加了IndexedDB存储适配器，提供跨浏览器兼容的本地存储解决方案
- 增强了FirefoxStorageAdapter功能，优化文件选择流程和错误处理
- 改进了适配器选择机制，实现基于浏览器支持情况的智能选择
- 优化了数据同步机制，确保不同存储方案之间的数据一致性
- 添加了更完善的错误处理和日志记录
- 添加了快捷方式文字颜色设置功能
- 改进了浏览器兼容性检测
- 增强了错误提示信息
- 添加了详细的README.md文档

### 历史版本
- 实现了导航项拖拽排序功能
- 修复了工具组功能问题
- 实现了工具组拖拽合并功能
- 重构了导航栏为搜索功能组件

## 联系信息

如有问题或建议，欢迎通过以下方式联系：
- 提交Issue：在项目仓库中提交Issue
- 发送邮件：[2468068569@qq.com](mailto:2468068569@qq.com)

---
